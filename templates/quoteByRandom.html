{% extends 'layout.html' %}

{% block body %}
    <style media="screen">

        .header {
            background-color: none;
        }
        .controls {
            position: absolute;
            bottom: 0; left: 5vw;
        }

        #quote {
            margin: 20px;
            padding: 10px;
            font-size: 48px;
        }

        #character {
            margin: 20px;
            padding: 10px;
            font-size: 40px;
        }

        #bg {
            -webkit-box-shadow: inset 0px 0px 150px 0px rgba(0,0,0,1);
            -moz-box-shadow: inset 0px 0px 150px 0px rgba(0,0,0,1);
            box-shadow: inset 0px 0px 150px 0px rgba(0,0,0,1);
        }

        .icon {
            position: absolute;
            bottom: 0; right: 1vw;
            margin: 10px;
        }

        .box-shadow { text-shadow: 0px 0px 20px #000000, 0px 0px 20px #000000, 0px 0px 20px #000000, 0px 0px 20px #000000, 0px 0px 30px #000000; }
    </style>

    <section id="bg" class="header text-white center-wrapper">
        <div class="center-content">
            <h3 id="quote" class="text-bold box-shadow">Click or Touch read</h3>
            <h1 id="character" class="text-bold box-shadow">Random Quotes</h1>
        </div>
    </section>

    <div class="controls text-white">
        <i class="far fa-copy fa-2x" onclick="copyQuote(this)" style="padding: 30px;"></i>
        <span id="copy-status"></span>
    </div>

    <div class="icon">
        <img src="{{ url_for('static', filename='logo.png') }}" height="18">    </div>
    </div>

    <script type="text/javascript">
        const URL = 'https://animeko.herokuapp.com'
        // const URL = 'http://localhost:8000'
        const APIREQUEST = `${URL}/generate_random_quotes`
        const BG = document.getElementById('bg');
        const QUOTE = document.getElementById('quote');
        const CHARACTER = document.getElementById('character');
        const copyStatus = document.getElementById('copy-status');
        let quoteList = [];

        function copyQuote(btn) {
            let selection = window.getSelection();
            let range = document.createRange();
            range.selectNodeContents(QUOTE);
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                selection.removeAllRanges();
                let o = btn.textContent;
                btn.classList.add('text-success');
                copyStatus.innerText = `Quote Copied`;
                setTimeout(() => {
                    btn.classList.remove('text-success');
                    copyStatus.innerText = ``;
                }, 1200);
            } catch(err) {
                let o = btn.textContent;
                btn.classList.add('text-danger');
                copyStatus.innerText = `Try Again`;
                setTimeout(() => {
                    btn.classList.remove('text-danger');
                    copyStatus.innerText = ``;
                }, 1200);
            }
        }

        BG.addEventListener("click", () => {
            if(quoteList.length > 1) { quoteList.shift(); }
            BG.style.backgroundImage =
                // `linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),
                `url("https://www.dropbox.com/s/${quoteList[0].image}?raw=1")`
            QUOTE.innerHTML = `"${quoteList[0].quote}"`;
            CHARACTER.innerText = `~ ${quoteList[0].character}`;
        });
        fetch(APIREQUEST)
            .then(r => r.json())
            .then(json => {
                quoteList = quoteList.concat(json.results);

                setInterval(() => {
                    if(quoteList.length <= 10) {
                        console.log('fetching more');
                        fetch(APIREQUEST)
                            .then(r => r.json())
                            .then(json => quoteList = quoteList.concat(json.results));
                    }
                }, 5000)
            });
    </script>
{% endblock %}
